# AI Agent: The Historical Court

## ภาพรวม (Overview)

โปรเจกต์นี้คือระบบ Multi-agent ที่จำลองกระบวนการใน "ศาลประวัติศาสตร์" (The Historical Court) เพื่อสืบค้นและประเมินบุคคลหรือเหตุการณ์ในประวัติศาสตร์อย่างรอบด้าน โดยมีเป้าหมายเพื่อสร้างรายงานสรุปที่เป็นกลาง (Neutral Report) จากข้อมูลทั้งในแง่บวกและแง่ลบ

ระบบนี้ใช้เฟรมเวิร์ก `google-adk` ในการสร้างและควบคุม Agent ต่างๆ ให้ทำงานร่วมกันอย่างเป็นระบบ โดย Agent แต่ละตัวจะมีบทบาทและหน้าที่ที่ชัดเจน ตั้งแต่การรับหัวข้อจากผู้ใช้, การสืบค้นข้อมูล, การประเมินหลักฐาน, ไปจนถึงการเขียนคำพิพากษา (รายงานสรุป)

## โครงสร้างและขั้นตอนการทำงานของ Agent (Agent Structure & Workflow)

กระบวนการทั้งหมดถูกควบคุมโดย `root_agent` ซึ่งทำหน้าที่เป็นจุดเริ่มต้นและประสานงานให้ Agent อื่นๆ ทำงานตามลำดับดังนี้:

### ขั้นตอนที่ 1: The Inquiry (การไต่สวนเบื้องต้น)

*   **Agent:** `historical_court_clerk` (`root_agent`)
*   **ประเภท:** `Agent` (ทำหน้าที่เป็น Sequential Controller)
*   **หน้าที่:**
    1.  เริ่มต้นการทำงานโดยทักทายผู้ใช้และต้อนรับเข้าสู่ "ศาลประวัติศาสตร์"
    2.  รับชื่อบุคคลหรือเหตุการณ์ทางประวัติศาสตร์ที่ผู้ใช้ต้องการ "นำขึ้นศาล"
    3.  บันทึกชื่อที่ได้รับลงใน State ของระบบในคีย์ `PROMPT`
    4.  ส่งมอบหน้าที่ต่อให้กับ `court_system` เพื่อเริ่มกระบวนการพิจารณาคดี

### ขั้นตอนที่ 2: The Trial Process (กระบวนการพิจารณาคดี)

ขั้นตอนนี้เป็นหัวใจหลักของระบบ ซึ่งทำงานในรูปแบบของ Loop (`LoopAgent`) เพื่อสืบค้นและประเมินหลักฐานซ้ำๆ จนกว่าจะได้ข้อมูลที่สมดุล

*   **Agent:** `trial_process`
*   **ประเภท:** `LoopAgent` (ทำงานวนซ้ำสูงสุด 4 รอบ)
*   **Agent ลูก (Sub-agents):**
    1.  `investigation_team`
    2.  `judge_agent`

#### 2.1) The Investigation (การสืบสวน)

*   **Agent:** `investigation_team`
*   **ประเภท:** `ParallelAgent`
*   **หน้าที่:** สั่งให้ Agent ลูก 2 ตัวทำงานพร้อมกันเพื่อค้นหาข้อมูลจาก Wikipedia

    *   **`admirer_agent` (ฝ่ายสนับสนุน):**
        *   **บทบาท:** ค้นหาข้อมูลใน **แง่บวก** เท่านั้น เช่น ความสำเร็จ, คุณงามความดี, หรือผลงานที่น่าชื่นชม
        *   **เครื่องมือ:** `WikipediaQueryRun`, `append_to_state`
        *   **ผลลัพธ์:** บันทึกข้อมูลที่ค้นพบลงใน State ที่ชื่อว่า `pos_data`

    *   **`critic_agent` (ฝ่ายค้าน):**
        *   **บทบาท:** ค้นหาข้อมูลใน **แง่ลบ** เท่านั้น เช่น ข้อโต้แย้ง, ความล้มเหลว, หรือคำวิจารณ์ต่างๆ
        *   **เครื่องมือ:** `WikipediaQueryRun`, `append_to_state`
        *   **ผลลัพธ์:** บันทึกข้อมูลที่ค้นพบลงใน State ที่ชื่อว่า `neg_data`

#### 2.2) The Judicial Review (การพิจารณาหลักฐาน)

*   **Agent:** `judge_agent`
*   **ประเภท:** `Agent` (LLM Agent)
*   **หน้าที่:**
    1.  ตรวจสอบข้อมูลที่รวบรวมได้จาก `pos_data` และ `neg_data`
    2.  **ตัดสินใจ:**
        *   **ถ้าข้อมูลยังไม่สมดุล:** (เช่น ฝ่ายใดฝ่ายหนึ่งมีข้อมูลน้อยเกินไป) Agent จะให้ Feedback เพื่อสั่งให้การสืบสวนในรอบถัดไปเจาะจงมากขึ้น (บันทึกลง `judge_feedback`) และปล่อยให้ Loop ทำงานต่อ
        *   **ถ้าข้อมูลสมดุลและเพียงพอแล้ว:** Agent จะใช้เครื่องมือ `exit_loop` เพื่อสิ้นสุดกระบวนการพิจารณาคดี

### ขั้นตอนที่ 3: The Verdict (การเขียนคำพิพากษา)

*   **Agent:** `verdict_writer`
*   **ประเภท:** `Agent` (LLM Agent)
*   **หน้าที่:**
    1.  รับข้อมูล `pos_data` และ `neg_data` ทั้งหมดที่รวบรวมได้จาก `trial_process`
    2.  เขียนรายงานสรุป (คำพิพากษา) ที่เป็นกลาง โดยนำเสนอข้อมูลจากทั้งสองฝ่ายอย่างสมดุล
    3.  ใช้เครื่องมือ `write_file` เพื่อบันทึกรายงานฉบับสมบูรณ์ลงในไฟล์ `.txt`
    4.  ไฟล์จะถูกเก็บไว้ในไดเรกทอรี `court_records/` โดยใช้ชื่อหัวข้อ (`PROMPT`) เป็นชื่อไฟล์

## เครื่องมือที่ใช้ (Tools)

*   `append_to_state`: ฟังก์ชันที่สร้างขึ้นเองเพื่อจัดการ State ของระบบ ทำให้ Agent สามารถส่งต่อข้อมูลระหว่างกันได้
*   `write_file`: ฟังก์ชันที่สร้างขึ้นเองเพื่อบันทึกผลลัพธ์สุดท้ายลงไฟล์
*   `exit_loop`: เครื่องมือมาตรฐานของ ADK สำหรับควบคุมการออกจาก `LoopAgent`
*   `LangchainTool (WikipediaQueryRun)`: เครื่องมือสำหรับเชื่อมต่อกับ LangChain เพื่อค้นหาข้อมูลจาก Wikipedia

## วิธีการรัน (How to Run)

1.  **ตั้งค่าสภาพแวดล้อม:**
    *   สร้างไฟล์ `.env` และกำหนดค่า `MODEL` (เช่น `gemini-1.5-flash-001`)
    *   ตรวจสอบว่าได้ตั้งค่า Google Cloud Authentication เรียบร้อยแล้ว

2.  **รัน Agent:**
    *   เรียกใช้ `root_agent` ซึ่งเป็น Entry Point ของระบบ
    *   Agent จะเริ่มถามชื่อบุคคลในประวัติศาสตร์จากคุณใน Terminal

3.  **ดูผลลัพธ์:**
    *   เมื่อกระบวนการทั้งหมดเสร็จสิ้น จะมีไฟล์รายงานปรากฏขึ้นในโฟลเดอร์ `court_records`

```

<!--
[PROMPT_SUGGESTION]อธิบายการทำงานของ `ToolContext` และ `state` ในไฟล์ `agent.py` หน่อย[/PROMPT_SUGGESTION]
[PROMPT_SUGGESTION]เราจะเพิ่มเครื่องมือค้นหาอื่น เช่น Google Search เข้าไปใน `investigation_team` ได้อย่างไร[/PROMPT_SUGGESTION]
-->
